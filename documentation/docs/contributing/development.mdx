---
sidebar_position: 0
---

{/* NOTE: URLs reference apollosai.dev. If forking this project, update to your domain. */}

# Development

Welcome to the development docs of Apollos! Thanks for your interest in being a contributor ❤️. Open source contributors are a corner-store of the Apollos community. We welcome all contributions, big or small.

To get started with contributing, check out the official GitHub docs on [contributing to an open-source project](https://docs.github.com/en/get-started/exploring-projects-on-github/contributing-to-a-project).

If you're looking for a place to get started, check out the list of [Github Issues](https://github.com/jrmatherly/apollos/issues) with the tag `good first issue` to find issues that are good for first-time contributors.

## Local Server Installation

### Using mise (Recommended)

[mise-en-place](https://mise.jdx.dev) manages tool versions, virtual environments, and common tasks for the project.

```shell
# Install mise (if not already installed)
curl https://mise.run | sh

# Clone and setup
git clone https://github.com/jrmatherly/apollos && cd apollos
mise install          # Installs Python 3.12, bun, uv
mise run setup        # Installs deps, migrates DB, builds frontend
mise run dev          # Starts server at http://localhost:42110
```

mise automatically activates the Python virtual environment when you `cd` into the project directory. Run `mise tasks ls` to see all available development tasks.

### Using Pip (Manual Setup)

#### 1. Apollos Installation

```mdx-code-block
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
```

  <Tabs groupId="operating-systems" queryString="os">
    <TabItem value="macos" label="MacOS">
    ```shell
# Get Apollos Code
git clone https://github.com/jrmatherly/apollos && cd apollos

# Create, Activate Virtual Environment

python3 -m venv .venv && source .venv/bin/activate

# Install dependencies (setuptools needed for openai-whisper build)

uv pip install setuptools && uv sync --all-extras --no-build-isolation-package openai-whisper

````
    </TabItem>
    <TabItem value="windows" label="Windows">
    ```shell
# Get Apollos Code
git clone https://github.com/jrmatherly/apollos && cd apollos

# Create, Activate Virtual Environment
python3 -m venv .venv && .venv\Scripts\activate

# Install Apollos for Development
uv pip install setuptools && uv sync --all-extras --no-build-isolation-package openai-whisper
```
    </TabItem>
    <TabItem value="linux" label="Linux">
    ```shell
# Get Apollos Code
git clone https://github.com/jrmatherly/apollos && cd apollos

# Create, Activate Virtual Environment
python3 -m venv .venv && source .venv/bin/activate

# Install Apollos for Development
uv pip install setuptools && uv sync --all-extras --no-build-isolation-package openai-whisper
```
    </TabItem>
  </Tabs>

#### 2. Postgres Installation & Setup

Apollos uses the `pgvector` package to store embeddings of your index in a Postgres database. To use this, you need to have Postgres installed.

<Tabs groupId="operating-systems" queryString="os">
  <TabItem value="macos" label="MacOS">
    Install [Postgres.app](https://postgresapp.com/). This comes pre-installed
    with `pgvector` and relevant dependencies.
  </TabItem>
  <TabItem value="windows" label="Windows">
    1. Use the [recommended
    installer](https://www.postgresql.org/download/windows/). 2. Follow
    instructions to [Install
    PgVector](https://github.com/pgvector/pgvector#windows) in case you need to
    manually install it. Windows support is experimental for pgvector currently,
    so we recommend using Docker. Refer to Windows Installation Notes below if
    there are errors.
  </TabItem>
  <TabItem value="linux" label="Linux">
    From [official instructions](https://wiki.postgresql.org/wiki/Apt)
  </TabItem>
  <TabItem value="source" label="From Source">
    1. Follow instructions to [Install
    Postgres](https://www.postgresql.org/download/) 2. Follow instructions to
    [Install PgVector](https://github.com/pgvector/pgvector#installation) in
    case you need to manually install it.
  </TabItem>
</Tabs>

##### Create the Apollos database

Make sure to update your environment variables to match your Postgres configuration if you're using a different name. The default values should work for most people. When prompted for a password, you can use the default password `postgres`, or configure it to your preference. Make sure to set the environment variable `POSTGRES_PASSWORD` to the same value as the password you set here.

<Tabs groupId="operating-systems" queryString="os">
  <TabItem value="macos" label="MacOS">
    ```shell createdb apollos -U postgres --password ```
  </TabItem>
  <TabItem value="windows" label="Windows">
    ```shell createdb -U postgres apollos --password ```
  </TabItem>
  <TabItem value="linux" label="Linux">
    ```shell sudo -u postgres createdb apollos --password ```
  </TabItem>
</Tabs>

#### 3. Build the front-end assets

```shell
cd src/interface/web/
bun install
bun export
````

You can optionally use `bun dev` to start a development server for the front-end which will be available at http://localhost:3000. This is especially useful if you're making changes to the front-end code, but not necessary for running Apollos. Note that streaming does not work on the dev server due to how it is handled with SSR in Next.js.

Always run `bun export` to test your front-end changes on http://localhost:42110 before creating a PR.

#### 4. Run

1. Start Apollos
   ```bash
   apollos -vv
   ```
2. Configure Apollos
   - **Via the Web UI**: Upload files and documents to index using the web interface at http://localhost:42110. You can drag and drop files into the chat window or use the search page to add documents.

Note: Wait after configuration for apollos to Load ML model, generate embeddings and expose API to query notes, images, documents etc specified in config YAML

#### Windows Installation Notes

1. Command `apollos` Not Recognized
   - Try reactivating the virtual environment and rerunning the `apollos` command.
   - If it still doesn't work repeat the installation process.
2. Python Package Missing
   - Use `uv add xxx` and try running the `apollos` command.
3. Command `createdb` Not Recognized
   - make sure path to postgres binaries is included in environment variables. It usually looks something like
   ```
   C:\Program Files\PostgreSQL\16\bin
   ```
4. Connection Refused on port xxxx
   - Locate the `pg_hba.conf` file in the location where postgres was installed.
   - Edit the file to have **trust** as the method for user postgres, local, and host connections.
   - Below is an example:

```
host    all             postgres        127.0.0.1/32            trust
# "local" is for Unix domain socket connections only
local   all             all                                     trust
# IPv4 local connections:
host    all             all             127.0.0.1/32            trust
# IPv6 local connections:
host    all             all             ::1/128                 trust
```

4. Errors with installing pgvector
   - Reinstall Visual Studio 2022 Build Tools with:
     1. desktop development with c++ selected in workloads
     2. MSVC (C++ Build Tools), Windows 10/11 SDK, and C++/CLI support for build tools selected in individual components.
   - Open the x64 Native Tools Command Prompt as an Administrator
   - Follow the pgvector windows installation [instructions](https://github.com/pgvector/pgvector?tab=readme-ov-file#windows) in this command prompt.

### Using Docker

Make sure you install the latest version of [Docker](https://docs.docker.com/get-docker/) and [Docker Compose](https://docs.docker.com/compose/install/).

#### 1. Clone

```shell
git clone https://github.com/jrmatherly/apollos && cd apollos
```

#### 2. Configure

1. Update [docker-compose.yml](https://github.com/jrmatherly/apollos/blob/master/docker-compose.yml) to use relevant environment variables.
2. Comment out the `image` line and uncomment the `build` line in the `server` service

#### 3. Run

This will start the Apollos server, and the database.

```shell
docker-compose up -d
```

#### 4. Upgrade

If you've made changes to the codebase, you'll need to rebuild the Docker image before running the container again.

```shell
docker-compose build --no-cache
```

## Update clients

In whichever clients you're using for testing, you'll need to update the server URL to point to your local server. By default, the local server URL should be `http://127.0.0.1:42110`.

## Validate

### Before Making Changes

1. Install Apollos and setup git hooks for validation:

   ```shell
   # With mise (recommended):
   mise run setup && mise run pre-commit

   # Or manually:
   ./scripts/dev_setup.sh
   ```

   - Installs the apollos server and web app by default. Use the `--full` flag with `dev_setup.sh` to also install the Apollos Obsidian plugin.
   - Git hooks format code, check types automatically on every commit and push respectively.
   - Note 1: If [pre-commit](https://pre-commit.com/#intro) didn't already get installed, [install it](https://pre-commit.com/#install) via `pip install pre-commit`
   - Note 2: To run the pre-commit changes manually, use `pre-commit run --hook-stage manual --all` before creating PR

### Before Creating PR

:::tip[Note]
If using mise, the virtual environment is automatically activated when you `cd` into the project directory. Otherwise, make sure you are in an active virtual environment.
:::

1. Ensure that you have a [Github Issue](https://github.com/jrmatherly/apollos/issues) that can be linked to the PR. If not, create one. Make sure you've tagged one of the maintainers to the issue. This will ensure that the maintainers are notified of the PR and can review it.
1. Run unit tests.
   ```shell
   mise run test:unit    # or: pytest -m "not chatquality"
   ```
1. Run the linter.
   ```shell
   mise run typecheck    # or: mypy --config-file=pyproject.toml
   ```
1. Run the full CI check.
   ```shell
   mise run ci           # lint + format check + unit tests
   ```
1. Think about how to add unit tests to verify the functionality you're adding in the PR. If you're not sure how to do this, ask for help in the Github issues.

### After Creating PR

1. Automated [validation workflows](https://github.com/jrmatherly/apollos/tree/master/.github/workflows) should run for every PR. Tag one of the maintainers in the PR to trigger it.

## Obsidian Plugin Development

### Plugin development setup

The core code for the Obsidian plugin is under `src/interface/obsidian`. The file `main.ts` is a good place to start.

1. In your CLI, go to the directory `src/interface/obsidian` in the Apollos repository.
2. Run `yarn install` to install the dependencies.
3. Run `yarn dev` to start the development server. This will continually rebuild the plugin as you make changes to the code.
   - Your code changes will be outputted to a file called `main.js` in the `obsidian` directory.

### Loading your development plugin in Obsidian

1. Make sure you have the Apollos plugin installed in Obsidian. [See the plugin page](https://publish.obsidian.md/hub/02+-+Community+Expansions/02.05+All+Community+Expansions/Plugins/khoj) # TODO: Update Obsidian plugin ID once re-published
1. Open Obsidian and go to your settings (gear icon in the bottom left corner)
1. Click on 'Community Plugins' in the left panel
1. Next to the 'Installed Plugins' heading, click on the folder icon to open the folder with the plugin's source code.
1. Open the `apollos` folder in the file explorer that opens. You'll see a file called `main.js` in this folder. To test your changes, replace this file with the `main.js` file that was generated by the development server in the previous section.

## Create Apollos Release (Only for Maintainers)

1. Create and tag release commit by running the bump_version script. The release commit sets version number in required metadata files.

```shell
./scripts/bump_version.sh -c "<release_version>"
```

2. Push commit and then the tag to trigger the release workflow to create Release with auto generated release notes.

```shell
git push origin master  # push release commit to apollos repository
git push origin <release_version>  # push release tag to apollos repository
```

3. [Optional] Update the Release Notes to highlight new features, fixes and updates

## Architecture

![](/img/apollos_architecture.png)

## Visualize Codebase

_[Interactive Visualization](https://mango-dune-07a8b7110.1.azurestaticapps.net/?repo=jrmatherly%2Fapollos)_

![](/img/apollos_codebase_visualization_0.2.1.png)

## Visualize Apollos Obsidian Plugin Codebase

![](/img/apollos_obsidian_codebase_visualization_0.2.1.png)
